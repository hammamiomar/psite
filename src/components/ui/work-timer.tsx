import React, { useState, useEffect, useRef, useCallback } from 'react'

const asciiNumbers: Record<string, string[]> = {
  '0': [
    "   ____    ",
    "  / __ \\   ",
    " / / / /   ",
    "/ /_/ /    ",
    "\\____/     "
  ],
  '1': [
    "   ___     ",
    "  <  /     ",
    "  / /      ",
    " / /       ",
    "/_/        "
  ],
  '2': [
    " ___       ",
    "|__ \\      ",
    "__/ /      ",
    "/ __/      ",
    "/____/     "
  ],
  '3': [
    " _____     ",
    "|__  /     ",
    "  /_ <     ",
    "___/ /     ",
    "/____/     "
  ],
  '4': [
    "__ __      ",
    "/ // /     ",
    "/ // /_    ",
    "/__  __/   ",
    "  /_/      "
  ],
  '5': [
    " ______    ",
    "/ ____/    ",
    "/___ \\     ",
    "____/ /    ",
    "/_____/    "
  ],
  '6': [
    " _____     ",
    "/ ___/     ",
    "/ __ \\     ",
    "/ /_/ /    ",
    "\\____/     "
  ],
  '7': [
    " _____     ",
    "/__  /     ",
    "  / /      ",
    " / /       ",
    "/_/        "
  ],
  '8': [
    " ____      ",
    "( __ )     ",
    "/ __  |    ",
    "/ /_/ /    ",
    "\\____/     "
  ],
  '9': [
    " ____      ",
    "/ __ \\     ",
    "/ /_/ /    ",
    "\\__, /     ",
    "/____/     "
  ],
  ':': [
    "   _       ",
    "  (_)      ",
    "   _       ",
    "  (_)      ",
    "           "
  ]
}

// Animation frames showing sparks traveling from both computers to meet in the middle
const activeFrames = [
  // Frame 1 - Start position
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_............*..............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 2 - Sparks start from both sides
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_^...........*..............^_|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 3
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_.^..........*.............^._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 4
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_..^.........*............^.._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 5
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_...^........*...........^..._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 6
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_....^.......*..........^...._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 7
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_.....^......*.........^....._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 8
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_......^.....*........^......_|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 9
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_.......^....*.......^......._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 10
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_........^...*......^........_|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 11
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_.........^..*.....^........._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 12
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_..........^.*...^..........._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 13
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_...........^*..^............_|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 14 - Sparks meet at center
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_...........^*^.............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 15 - Big spark explosion
  [
    "   _______________     ***     ***        |*\\_/*|________",
    "  |  ___________  |    *^^^** **^^^*     ||_/-\\_|______  |",
    "  | |           | |   *^****^*^****^*    | |           | |",
    "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
    "  | |     -     | |    *^*********^*     | |     -     | |",
    "  | |   \\___/   | |     *^*******^*      | |   \\___/   | |",
    "  | |___     ___| |      *^*****^*       | |___________| |",
    "  |_____|\\_/|_____|       *^***^*        |_______________|",
    "    _|__|/ \\|_|_..........*^*^*............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 16 - Spark continues
  [
    "   _______________     ***     ***        |*\\_/*|________",
    "  |  ___________  |    *^^^** **^^^*     ||_/-\\_|______  |",
    "  | |           | |   *^****^*^****^*    | |           | |",
    "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
    "  | |     -     | |    *^*********^*     | |     -     | |",
    "  | |   \\___/   | |     *^*******^*      | |   \\___/   | |",
    "  | |___     ___| |      *^*****^*       | |___________| |",
    "  |_____|\\_/|_____|       *^***^*        |_______________|",
    "    _|__|/ \\|_|_..........*^*^*............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 17 - Return to normal
  [
    "   _______________                        |*\\_/*|________",
    "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
    "  | |           | |    .****. .****.     | |           | |",
    "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
    "  | |     -     | |     .*********.      | |     -     | |",
    "  | |   \\___/   | |      .*******.       | |   \\___/   | |",
    "  | |___     ___| |       .*****.        | |___________| |",
    "  |_____|\\_/|_____|        .***.         |_______________|",
    "    _|__|/ \\|_|_............*..............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 18 - Another spark
  [
    "   _______________     ***     ***        |*\\_/*|________",
    "  |  ___________  |    *^^^** **^^^*     ||_/-\\_|______  |",
    "  | |           | |   *^****^*^****^*    | |           | |",
    "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
    "  | |     -     | |    *^*********^*     | |     -     | |",
    "  | |   \\___/   | |     *^*******^*      | |   \\___/   | |",
    "  | |___     ___| |      *^*****^*       | |___________| |",
    "  |_____|\\_/|_____|       *^***^*        |_______________|",
    "    _|__|/ \\|_|_..........*^*^*............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ],
  // Frame 19 - Final spark
  [
    "   _______________     ***     ***        |*\\_/*|________",
    "  |  ___________  |    *^^^** **^^^*     ||_/-\\_|______  |",
    "  | |           | |   *^****^*^****^*    | |           | |",
    "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
    "  | |     -     | |    *^*********^*     | |     -     | |",
    "  | |   \\___/   | |     *^*******^*      | |   \\___/   | |",
    "  | |___     ___| |      *^*****^*       | |___________| |",
    "  |_____|\\_/|_____|       *^***^*        |_______________|",
    "    _|__|/ \\|_|_..........*^*^*............._|________|_",
    "   / ********** \\                          / ********** \\",
    " /  ************  \\                      /  ************  \\",
    "--------------------                    --------------------"
  ]
]

const inactiveFrame = [
  "   _______________                        |*\\_/*|________",
  "  |  ___________  |     .-.     .-.      ||_/-\\_|______  |",
  "  | |           | |    .****. .****.     | |           | |",
  "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
  "  | |     -     | |     .*********.      | |     -     | |",
  "  | |   _____   | |      .*******.       | |   _____   | |",
  "  | |___     ___| |       .*****.        | |___________| |",
  "  |_____|\\_/|_____|        .***.         |_______________|",
  "    _|__|/ \\|_|_............*..............._|________|_",
  "   / ********** \\                          / ********** \\",
  " /  ************  \\                      /  ************  \\",
  "--------------------                    --------------------"
]

interface WorkTimerProps {
  className?: string
}

export default function WorkTimer({ className = '' }: WorkTimerProps) {
  const [isActive, setIsActive] = useState(true)
  const [activeTime, setActiveTime] = useState(0)
  const [inactiveTime, setInactiveTime] = useState(0)
  const [frameIndex, setFrameIndex] = useState(0)
  const [isVisible, setIsVisible] = useState(false)
  const lastToggleRef = useRef(Date.now())

  useEffect(() => {
    setIsVisible(true)
  }, [])

  useEffect(() => {
    const interval = setInterval(() => {
      const now = Date.now()
      const elapsed = (now - lastToggleRef.current) / 1000

      if (isActive) {
        setActiveTime(prev => prev + elapsed)
      } else {
        setInactiveTime(prev => prev + elapsed)
      }
      lastToggleRef.current = now

      if (isActive) {
        setFrameIndex((prev) => (prev + 1) % activeFrames.length)
      }
    }, 200)

    return () => clearInterval(interval)
  }, [isActive])

  const toggleState = useCallback(() => {
    setIsActive(!isActive)
  }, [isActive])

  // Add keyboard event listener for spacebar
  useEffect(() => {
    const handleKeyPress = (e: KeyboardEvent) => {
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault() // Prevent page scroll
        toggleState()
      }
    }

    window.addEventListener('keydown', handleKeyPress)
    return () => window.removeEventListener('keydown', handleKeyPress)
  }, [toggleState])

  const formatTime = (seconds: number): string => {
    const hours = Math.floor(seconds / 3600)
    const minutes = Math.floor((seconds % 3600) / 60)
    const secs = Math.floor(seconds % 60)
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`
  }

  const convertToAsciiArt = (timeStr: string): string[] => {
    const result = ['', '', '', '', '']
    
    for (const char of timeStr) {
      if (char in asciiNumbers) {
        for (let i = 0; i < 5; i++) {
          result[i] += asciiNumbers[char][i]
        }
      }
    }
    
    return result
  }

  const currentFrame = isActive ? activeFrames[frameIndex] : inactiveFrame

  return (
    <div className={`${className} font-mono transition-opacity duration-500 ${isVisible ? 'opacity-100' : 'opacity-0'}`}>
      <div className="text-center space-y-2 w-full">
        <div className="space-y-4 mb-4">
          <div>
            <div className="text-muted-foreground mb-1 text-xs sm:text-sm">Work Time:</div>
            <pre className="inline-block text-[6px] xs:text-[7px] sm:text-[9px]">
              {convertToAsciiArt(formatTime(activeTime)).join('\n')}
            </pre>
          </div>
          
          <div>
            <div className="text-muted-foreground mb-1 text-xs sm:text-sm">Break Time:</div>
            <pre className="inline-block text-[6px] xs:text-[7px] sm:text-[9px]">
              {convertToAsciiArt(formatTime(inactiveTime)).join('\n')}
            </pre>
          </div>
        </div>
        
        <div className="overflow-x-hidden pb-2">
          <pre className="text-[6px] xs:text-[7px] sm:text-[8px] md:text-[10px] lg:text-xs whitespace-pre">
            {currentFrame.join('\n')}
          </pre>
        </div>
        
        <div className="text-muted-foreground text-xs sm:text-sm">
          State: <span className="font-semibold">{isActive ? 'WORKING' : 'NOT WORKING'}</span>
          <br className="sm:hidden" />
          <button 
            onClick={toggleState}
            className="mx-2 px-2 py-1 rounded hover:bg-muted transition-colors inline-flex items-center gap-1 mt-1 sm:mt-0"
          >
            Press <kbd className="px-1.5 py-0.5 text-xs border rounded">Space</kbd> to toggle
          </button>
        </div>
      </div>
    </div>
  )
}